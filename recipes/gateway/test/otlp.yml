description: |
  Receives OTLP data over HTTP (on port 4318) and gRPC (on port 4317) and exports it to Elasticsearch.
args:
  elastic_endpoint:
    description: Your Elasticsearch endpoint
    env: ELASTIC_URL
  elastic_api_key:
    description: Your Elasticsearch API Key
    env: ELASTIC_API_KEY
components:
  otlp:
    source: receivers/otlp.yml
    configurations: [ http, grpc ]
    vars:
      http_port: 4318
      grpc_port: 4317
  elasticapm-connector:
    source: connectors/elasticapm.yml
  elasticsearch-exporter:
    source: exporters/elasticsearch.yml
    configurations: [insecure]
    vars:
      elastic_endpoint: $args.elastic_endpoint
      elastic_api_key: $args.elastic_api_key
  elasticapm-processor:
    source: processors/elasticapm.yml
  batch:
    source: processors/batch.yml
  debug-exporter:
    source: exporters/debug.yml
service:
  pipelines:
    traces:
      receivers: [ $components.otlp ]
      processors: [ $components.batch, $components.elasticapm-processor ]
      exporters: [ $components.debug-exporter, $components.elasticapm-connector, $components.elasticsearch-exporter ]
    logs:
      receivers: [ $components.otlp ]
      processors: [ $components.batch, $components.elasticapm-processor ]
      exporters: [ $components.debug-exporter, $components.elasticapm-connector, $components.elasticsearch-exporter ]
    metrics:
      receivers: [ $components.otlp ]
      processors: [ $components.batch, $components.elasticapm-processor ]
      exporters: [ $components.debug-exporter, $components.elasticsearch-exporter ]
    metrics/aggregated-otel-metrics:
      receivers: [ $components.elasticapm-connector ]
      processors: [ ]
      exporters: [ $components.debug-exporter, $components.elasticsearch-exporter ]